# Project Documentation - توثيق المشروع

## نظرة عامة

هذا تطبيق Flutter متكامل لإدارة عمليات التوصيل والمخزون والوقود، مصمم خصيصاً للمندوبين وأصحاب الأعمال في مجال توصيل شرائح الاتصالات.

## الوظائف الأساسية

### 1. نظام المصادقة (Authentication)
- تسجيل دخول بأسماء مستخدمين وكلمات مرور
- دعم دورين: مدير (admin) ومندوب (delegate)
- التحقق من صلاحية الاشتراك للمندوبين
- حساب افتراضي: admin/admin123

### 2. إدارة التوصيلات (Delivery Management)

#### أنواع التوصيلات:
1. **جوي (Jawy)**
   - أقل من ساعتين: 30 ريال
   - 2-3 ساعات: 25 ريال
   - أكثر من 3 ساعات: 20 ريال

2. **سوا (Sawa)**
   - أقل من ساعتين: 28 ريال
   - 2-3 ساعات: 24 ريال
   - أكثر من 3 ساعات: 20 ريال

3. **متعدد (Multiple)**
   - نفس أسعار سوا
   - مع اختيار عدد الشرائح (1، 2، أو 3)

4. **لم يكتمل (Incomplete)**
   - عمولة ثابتة: 10 ريال

5. **جهاز (Device)**
   - إدخال السعر يدوياً

#### الميزات:
- تسجيل سريع للتوصيلات
- حساب تلقائي للعمولات
- عرض سجل يومي للتوصيلات
- إمكانية حذف التوصيلات
- خصم تلقائي من المخزون

### 3. إدارة المخزون (Inventory Management)

#### الوظائف:
- **استلام المخزون**: تسجيل شرائح جديدة (جوي/سوا/متعدد)
- **عرض المخزون**: إجمالي كل نوع والمخزون الكلي
- **الخصم التلقائي**: عند تسجيل توصيل
- **الشرائح المعطلة**: 
  - تسجيل شرائح معطلة
  - إرجاع للشركة
  - إرجاع للمخزون
- **سجل المعاملات**: عرض جميع عمليات المخزون

### 4. إدارة الوقود (Fuel Management)

#### الميزات:
- **تسجيل التعبئة**:
  - التاريخ (افتراضي: اليوم)
  - نوع الوقود (91 أو 95)
  - عدد اللترات
  - المسافة المقطوعة (اختياري)
  - التكلفة (حساب تلقائي)

- **أسعار الوقود**:
  - أخضر 91: 2.18 ريال/لتر
  - أحمر 95: 2.33 ريال/لتر

- **معدل الاستهلاك**:
  - حساب كم/لتر
  - معدل يومي
  - معدل أسبوعي
  - معدل شهري

- **الملخصات**:
  - إجمالي اللترات
  - إجمالي التكلفة
  - التنقل بين الفترات

### 5. التقارير (Reports)

#### أنواع التقارير:
- **يومي**: ملخص يوم واحد
- **أسبوعي**: من الأحد إلى السبت
- **شهري**: الشهر الكامل

#### المحتوى:
- إجمالي التوصيلات لكل نوع
- إجمالي العمولات
- استهلاك الوقود
- رسوم بيانية:
  - Bar Chart (أعمدة)
  - Pie Chart (دائري)
  - Line Chart (خطي)

### 6. الإعدادات (Settings)

#### للجميع:
- تعديل اسم العرض
- تحديد الهدف الأسبوعي (افتراضي: 1000 ريال)
- اختيار نوع الوقود المفضل
- تعديل أسعار العمولات

#### للمدير فقط:
- إضافة مندوبين جدد
- تحديد فترة الاشتراك (أسبوع/شهر)
- حذف مندوبين
- عرض قائمة المندوبين

### 7. الهدف الأسبوعي (Weekly Goal)

- يظهر كسلايدر في الصفحة الرئيسية
- حساب الأسبوع من الأحد إلى السبت
- عرض نسبة الإنجاز
- عرض المبلغ المحصل والمتبقي
- قابل للتعديل من الإعدادات

## البنية التقنية

### State Management
- استخدام Provider لإدارة الحالة
- Providers منفصلة لكل وحدة:
  - AuthProvider
  - DeliveryProvider
  - InventoryProvider
  - FuelProvider
  - SettingsProvider

### Data Storage
- **Local**: Hive (قاعدة بيانات محلية سريعة)
- **Cloud**: Firebase Firestore (اختياري)
- **Sync**: مزامنة تلقائية بين المحلي والسحابي

### Data Models
كل نموذج مع Hive annotations:
- User
- Delivery
- InventoryTransaction
- FaultySim
- FuelEntry
- AppSettings

### Calculations
- حساب العمولات بناءً على النوع والوقت
- حساب تكلفة الوقود
- حساب معدل الاستهلاك
- حساب نسبة الهدف الأسبوعي
- حساب المخزون المتبقي

### Date Handling
- حساب بداية ونهاية الأسبوع (الأحد-السبت)
- حساب بداية ونهاية الشهر
- مقارنة التواريخ
- تنسيق التواريخ بالعربية

## تدفق البيانات

1. **تسجيل الدخول**:
   - AuthProvider → LocalStorage → User
   
2. **تسجيل توصيل**:
   - DeliveryProvider → Calculations → LocalStorage
   - InventoryProvider → Update Stock
   
3. **استلام مخزون**:
   - InventoryProvider → LocalStorage → Update Display

4. **تسجيل وقود**:
   - FuelProvider → Calculations → LocalStorage

5. **عرض تقرير**:
   - DeliveryProvider + FuelProvider → Calculations → Display

## الأمان

- كلمات المرور مخزنة (يُنصح بالتشفير في الإصدارات القادمة)
- فصل بيانات كل مستخدم
- صلاحيات محددة لكل دور
- التحقق من صلاحية الاشتراك

## التخصيص

### تعديل الألوان:
ملف: `lib/config/theme.dart`

### تعديل الأسعار الافتراضية:
ملف: `lib/config/constants.dart`

### إضافة نوع توصيل جديد:
1. إضافة في `constants.dart`
2. تحديث `calculations.dart`
3. إضافة زر في `delivery_buttons.dart`

## الاختبار

### بيانات تجريبية:
- حساب المدير: admin/admin123
- يمكن إضافة مندوبين من الإعدادات

### السيناريوهات:
1. تسجيل دخول
2. تسجيل توصيلات مختلفة
3. استلام مخزون
4. تسجيل وقود
5. عرض التقارير
6. تعديل الإعدادات

## الصيانة

### النسخ الاحتياطي:
- البيانات محفوظة في Hive
- يمكن المزامنة مع Firebase
- ملفات Hive في مجلد التطبيق

### التحديثات:
- تحديث الحزم: `flutter pub upgrade`
- إعادة بناء Hive: `flutter pub run build_runner build --delete-conflicting-outputs`

## المشاكل الشائعة

### Hive not initialized:
```dart
await Hive.initFlutter();
```

### Build runner issues:
```bash
flutter pub run build_runner clean
flutter pub run build_runner build --delete-conflicting-outputs
```

### Firebase connection:
- التأكد من ملفات الإعداد
- تفعيل الخدمات في Console

## الإضافات المستقبلية

- [ ] تصدير التقارير PDF
- [ ] الإشعارات
- [ ] الوضع الليلي
- [ ] دعم لغات متعددة
- [ ] نظام النسخ الاحتياطي التلقائي
- [ ] تحليلات متقدمة
- [ ] Widget للشاشة الرئيسية

## الدعم الفني

للمساعدة والاستفسارات:
- فتح Issue في GitHub
- التواصل عبر البريد الإلكتروني

---

آخر تحديث: ديسمبر 2024
